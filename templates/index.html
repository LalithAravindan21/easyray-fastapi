<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>TB Detection - Radiologist Panel</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
  <div class="max-w-3xl mx-auto bg-white p-6 rounded shadow">
    <h1 class="text-2xl font-bold mb-4">TB Detection Tool for Radiologists</h1>

    <form id="registerForm" class="space-y-4">
      <input name="patient_id" placeholder="Patient ID" class="w-full p-2 border" required />
      <input name="name" placeholder="Name" class="w-full p-2 border" required />
      <input name="age" type="number" placeholder="Age" class="w-full p-2 border" required />
      <input name="gender" placeholder="Gender" class="w-full p-2 border" required />
      <button class="bg-blue-500 text-white px-4 py-2" type="submit">Register Patient</button>
    </form>

    <hr class="my-6" />

    <form id="uploadForm" class="space-y-4">
      <input name="patient_id" placeholder="Patient ID" class="w-full p-2 border" required />
      <input name="xray" type="file" accept="image/*" class="w-full p-2 border" required />
      <button class="bg-green-500 text-white px-4 py-2" type="submit">Upload X-ray</button>
    </form>

    <div id="result" class="mt-6 p-4 bg-gray-50 border border-gray-200 hidden"></div>
  </div>

  <script>
    document.getElementById("registerForm").onsubmit = async function (e) {
      e.preventDefault();
      const form = new FormData(e.target);
      const res = await fetch("/register/", {
        method: "POST",
        body: form,
      });
      const data = await res.json();
      alert("Patient registered: " + data.patient.name);
    };

    document.getElementById("uploadForm").onsubmit = async function (e) {
      e.preventDefault();
      const form = new FormData(e.target);
      const res = await fetch("/analyze/", {
        method: "POST",
        body: form,
      });
      const data = await res.json();

      const resultBox = document.getElementById("result");
      resultBox.classList.remove("hidden");
      resultBox.innerHTML = `
        <h2 class="text-xl font-semibold mb-2">Report for Patient: ${data.patient_id}</h2>
        <p><strong>Result:</strong> ${data.report.result}</p>
        <p><strong>Severity:</strong> ${data.report.severity}</p>
        <p><strong>Confidence:</strong> ${data.report.confidence}</p>
        <p class="text-sm mt-2 text-gray-500">Note: AI-generated, consult a medical professional.</p>
      `;
    };
  </script>
</body>
</html>
